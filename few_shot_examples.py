"""
Few-Shot Learning을 위한 샘플 데이터
실제 Bill of Lading 수정사항 예시
"""

# 샘플 수정사항 패턴
SAMPLE_EXAMPLES = """
### 학습 예시 0: ❌ 강조 표시 (수정/삭제 아님!) ⚠️⚠️⚠️
이미지 설명: "FREIGHT PREPAID" 텍스트가 붉은색 박스로 표시됨
  - 박스로 둘러싸여 있음 (강조 목적)
  - **취소선이나 물결선 전혀 없음**
  - **화살표 없음**
  - **손글씨 없음**
  - **번호 표시 없음**
분석 결과: **이것은 수정/삭제가 아닙니다! 단순 강조 표시입니다!**
⚠️ 중요:
- **박스만 있고 취소선/물결선/화살표/손글씨가 전혀 없으면 = 강조일 뿐, 삭제 아님!**
- **이런 경우는 JSON 결과에 절대 포함하지 마세요!**
- **"FREIGHT PREPAID", "AS ARRANGED", "TO ORDER" 등에 박스만 있으면 무시하세요!**

정답 JSON: []
(빈 배열 - 아무것도 포함하지 않음!)

### 학습 예시 1: 수정 패턴
이미지 설명: "ABU DHABI, U.A.EMIRATES" 텍스트가 붉은색 박스로 표시되고, 화살표(→)가 "ABU DHABI, U.A.E"로 연결됨
분석 결과:
{
  "order": 1,
  "action": "수정",
  "original_text": "ABU DHABI, U.A.EMIRATES",
  "new_text": "ABU DHABI, U.A.E",
  "location": "Place of Receipt",
  "confidence": "high"
}

### 학습 예시 2: 여러 줄 삭제 패턴 (중요!)
이미지 설명: 두 줄의 텍스트가 함께 박스로 표시됨:
  첫 줄: "TEL:0574-87170623"
  둘째 줄: "FAX:0574-87026831"
  두 줄 모두 붉은색 박스로 묶여있고 취소선/물결표시
분석 결과:
{
  "order": 2,
  "action": "삭제",
  "original_text": "TEL:0574-87170623\\nFAX:0574-87026831",
  "new_text": "(DELETE)",
  "location": "Notify Party",
  "confidence": "high"
}
⚠️ 주의: 여러 줄이 함께 박스로 묶여있으면 모두 하나의 항목으로 인식하고 \\n으로 구분!

### 학습 예시 3: 여러 줄 수정 패턴 (중요!)
이미지 설명: 박스로 표시된 두 줄의 원본 텍스트:
  첫 줄: "LDPE FT4119"
  둘째 줄: "QUANTITY. 24.75MT"
  화살표로 연결된 손글씨 (두 줄):
  첫 줄: "COMMODITY : LDPE FT4119"
  둘째 줄: "QUANTITY : 24.75MT"
분석 결과:
{
  "order": 3,
  "action": "수정",
  "original_text": "LDPE FT4119\\nQUANTITY. 24.75MT",
  "new_text": "COMMODITY : LDPE FT4119\\nQUANTITY : 24.75MT",
  "location": "Description of Goods",
  "confidence": "high"
}
⚠️ 주의: 여러 줄의 텍스트는 각 줄을 정확히 읽고 \\n으로 구분하여 표현!

### 학습 예시 4: 위치 변경 패턴
이미지 설명: Final Destination 필드의 "NEW YORK, USA" 텍스트가 박스로 표시되고, 화살표가 "ABU DHABI, U.A.E"를 가리킴
분석 결과:
{
  "order": 4,
  "action": "수정",
  "original_text": "NEW YORK, USA",
  "new_text": "ABU DHABI, U.A.E",
  "location": "Final Destination",
  "confidence": "high"
}

### 학습 예시 5: 물결선/취소선 삭제 패턴 (매우 중요!) ⚠️
이미지 설명: 텍스트가 붉은색 박스로 쳐지고 물결선(~~~ 돼지꼬리) 또는 취소선(---)이 그어짐
  - "HS CODE : 39011000" 위에 ~~~ 표시
  - "TEL:0574-87170623\nFAX:0574-87026831" 위에 ~~~ 표시
분석 결과:
{
  "order": 5,
  "action": "삭제",
  "original_text": "HS CODE : 39011000",
  "new_text": "(DELETE)",
  "location": "Description of Packages and Goods",
  "confidence": "high"
}
⚠️ 중요:
- **물결선(~~~, 돼지꼬리) 또는 취소선(---)이 텍스트 위에 있으면 무조건 삭제!**
- **박스 + 물결선 = 100% 삭제 지시사항**
- **여러 항목에 물결선이 그어져 있으면 각각 별도의 삭제 항목으로 인식!**

### 학습 예시 5-2: 취소선 삭제 패턴 (매우 중요!) ⚠️⚠️
이미지 설명: "14 DAYS CONTAINER FREE DETENTION AND DEMURRAGE AT POD" 텍스트에 붉은색 취소선이 그어짐
  - 박스나 동그라미로 텍스트 표시
  - 텍스트 위/가운데를 관통하는 붉은색 취소선
  - 화살표나 새 텍스트 없음
분석 결과:
{
  "order": 2,
  "action": "삭제",
  "original_text": "14 DAYS CONTAINER FREE DETENTION AND DEMURRAGE AT POD",
  "new_text": "(DELETE)",
  "location": "Additional Clauses",
  "confidence": "high"
}
⚠️⚠️⚠️ 최우선 규칙:
- **취소선이 텍스트를 관통하면 = 무조건 "삭제"!**
- **화살표가 있어도 취소선이 있으면 = "삭제" 우선!**
- **action은 반드시 "삭제", new_text는 반드시 "(DELETE)"!**
- **"수정"으로 절대 분류하지 마세요!**

### 학습 예시 5-2-2: NOTIFY PARTY 연락처 정보 삭제 패턴 (매우 중요! 자주 누락됨!) ⚠️⚠️⚠️
이미지 설명: NOTIFY PARTY 섹션 하단의 여러 줄 연락처 정보에 붉은색 박스 + 돼지꼬리 물결선
  - 4개의 독립된 박스로 각각 표시됨:
    1. "USCI: 91330212MA28840CY4D" - 박스 + 돼지꼬리
    2. "CONTACT PERSON NAME: MS. JOY SHAO" - 박스 + 돼지꼬리
    3. "CONTACT PERSON TEL: 86-574-88291892" - 박스 + 돼지꼬리
    4. "EMAIL: JOYSHAO@CHISAGE.COM" - 박스 + 돼지꼬리
  - 각 줄마다 별도의 박스와 물결선 표시
  - 화살표나 새 텍스트 없음
  - **매우 자주 놓치는 항목들이므로 반드시 확인!**

분석 결과 - 4개의 별도 항목:
{
  "order": 10,
  "action": "삭제",
  "original_text": "USCI: 91330212MA28840CY4D",
  "new_text": "(DELETE)",
  "location": "Notify Party",
  "confidence": "high"
}
{
  "order": 11,
  "action": "삭제",
  "original_text": "CONTACT PERSON NAME: MS. JOY SHAO",
  "new_text": "(DELETE)",
  "location": "Notify Party",
  "confidence": "high"
}
{
  "order": 12,
  "action": "삭제",
  "original_text": "CONTACT PERSON TEL: 86-574-88291892",
  "new_text": "(DELETE)",
  "location": "Notify Party",
  "confidence": "high"
}
{
  "order": 13,
  "action": "삭제",
  "original_text": "EMAIL: JOYSHAO@CHISAGE.COM",
  "new_text": "(DELETE)",
  "location": "Notify Party",
  "confidence": "high"
}

⚠️⚠️⚠️ 특별 주의:
- **NOTIFY PARTY 섹션 하단의 연락처 정보들은 매우 자주 누락됩니다!**
- **각 줄마다 별도의 박스 + 돼지꼬리가 있으면 각각 독립된 삭제 항목입니다!**
- **4개 항목이 연속으로 있어도 각각 별도 항목으로 인식!**
- **USCI, CONTACT PERSON NAME, CONTACT PERSON TEL, EMAIL - 모두 확인!**
- **이미지 중간~하단 영역을 반드시 전체 스캔하세요!**
- **작은 박스들도 절대 놓치지 마세요!**

### 학습 예시 5-3: 돼지꼬리(~~~) 물결선 삭제 패턴 - 다양한 형태 (매우 중요!) ⚠️⚠️⚠️
돼지꼬리 물결선은 다양한 형태로 나타납니다. **모든 형태를 삭제 표시로 인식하세요!**

#### 패턴 1: 넓은 루프 2개 (가장 일반적)
이미지 설명: 텍스트 위에 넓고 부드러운 물결선, 2개의 큰 루프
  - 붉은색, 얇은 선
  - 균일한 간격의 루프
  - 매끄러운 곡선
→ **100% 삭제!**

#### 패턴 2: 타이트한 루프 2개
이미지 설명: 텍스트 위에 좁고 각진 물결선, 2개의 작은 루프
  - 붉은색, 얇은 선
  - 루프가 서로 가까움
  - 시작 부분에 약간의 꺾임
→ **100% 삭제!**

#### 패턴 3: 두꺼운 루프
이미지 설명: 텍스트 위에 굵은 물결선, 2개의 겹쳐진 루프
  - 붉은색, 두꺼운 선
  - 루프가 서로 겹침 (interlocked)
  - 볼드한 외관
→ **100% 삭제!**

#### 패턴 4: 반투명 물결선
이미지 설명: 텍스트 위에 연한 분홍색 물결선, 2개의 넓은 루프
  - 연한 분홍색 (light pink)
  - 중간 굵기, 반투명 효과
  - 부드러운 외관
→ **100% 삭제!**

#### 패턴 5: 얇고 섬세한 물결선
이미지 설명: 텍스트 위에 매우 얇은 분홍색 물결선
  - 연한 분홍색
  - 매우 얇은 선
  - 간단하고 섬세함
→ **100% 삭제!**

#### 패턴 6: 끊어진 물결선
이미지 설명: 텍스트 위에 불완전한 물결선, 왼쪽 루프가 끊김
  - 희미한 붉은색
  - 매우 얇은 선
  - 미완성된 루프
→ **100% 삭제!** (불완전해도 삭제 표시!)

#### 패턴 7: 대칭 물결선
이미지 설명: 텍스트 위에 완벽하게 대칭인 물결선
  - 밝은 붉은색
  - 중간 굵기
  - 완벽한 대칭
→ **100% 삭제!**

#### 패턴 8: 연결이 부드러운 물결선
이미지 설명: 텍스트 위에 부드럽게 연결된 물결선
  - 연한 적갈색 (reddish-brown)
  - 매우 얇은 선
  - 루프 사이의 부드러운 곡선
→ **100% 삭제!**

#### 패턴 9: 점선 스타일 물결선
이미지 설명: 텍스트 위에 점으로 이루어진 물결선
  - 밝은 붉은색
  - 점선 텍스처 (dotted)
  - 공기 같은 느낌 (airy)
→ **100% 삭제!**

#### 패턴 10: 날카로운 루프 물결선
이미지 설명: 텍스트 위에 날카롭고 빡빡한 루프
  - 밝은 붉은색
  - 얇은 선
  - 과장된 간격의 타이트 루프
→ **100% 삭제!**

#### 패턴 11: 넓고 매끄러운 전문적 물결선
이미지 설명: 텍스트 위에 넓고 일정한 물결선
  - 밝은 붉은색
  - 중간 굵기
  - 일관되고 세련된 모양
→ **100% 삭제!**

⚠️⚠️⚠️ **핵심 규칙**:
- **물결선의 형태, 색상, 굵기에 관계없이 = 모두 100% 삭제!**
- **넓은 루프든, 좁은 루프든 = 삭제!**
- **밝은 붉은색이든, 연한 분홍색이든 = 삭제!**
- **완전한 선이든, 점선이든, 끊어진 선이든 = 삭제!**
- **두꺼운 선이든, 얇은 선이든 = 삭제!**
- **대칭이든, 비대칭이든 = 삭제!**
- **2개 루프든, 3개 루프든 = 삭제!**
- **물결선이 보이면 무조건 action = "삭제", new_text = "(DELETE)"!**

### 학습 예시 6: 번호 표시 패턴 (매우 중요!) ⚠️
이미지 설명: Port of Loading 필드에 "#20" 번호가 표시되고, 그 주변에 손글씨가 있음
  - 원본 텍스트(검은색): "KHALIFA PORT, ABU DHABI, UAE"
  - #20 주변의 손글씨: "KHALIFA PORT, U.A.E"
분석 결과:
{
  "order": 6,
  "action": "수정",
  "original_text": "KHALIFA PORT, ABU DHABI, UAE",
  "new_text": "KHALIFA PORT, U.A.E",
  "location": "Port of Loading",
  "confidence": "high"
}
⚠️ 주의사항:
- 번호 표시(#20, #15)는 명확한 화살표 없이도 수정 지시사항입니다!
- **원본 텍스트를 완전하게 읽으세요!** "ABU DHABI"를 빠뜨리지 마세요!
- **손글씨의 쉼표(,)와 마침표(.)를 절대 빠뜨리지 마세요!**
- **U.A.E는 3개의 점이 있습니다: U.A.E**

### 학습 예시 6-2: 여러 개의 번호가 밀집된 패턴 (매우 중요!) ⚠️⚠️
이미지 설명: Description of Packages 섹션 하단에 #35, #36, #37 번호들이 가까이 있음
  - #35 주변에 손글씨: "ITEM 11: HDPE OFF GRADE HE3490 LSX\nQUANTITY: 339.625 MT"
  - #36 주변에 손글씨: (다른 내용)
  - #37 주변에 손글씨: (또 다른 내용)
분석 결과 - 각 번호를 별도 항목으로:
{
  "order": 35,
  "action": "수정",
  "original_text": "COMMODITY: HDPE OFF GRADE HE3490LSX\\nTOTAL NET WEIGHT: 339.625 MT\\nHS-CODE: 390120000000",
  "new_text": "ITEM 11: HDPE OFF GRADE HE3490 LSX\\nQUANTITY: 339.625 MT",
  "location": "Description of Packages and Goods",
  "confidence": "high"
}
⚠️ 주의사항:
- **여러 개의 번호(#35, #36, #37)가 가까이 있어도 각각 별도로 분석!**
- **번호 하나당 하나의 수정 항목을 생성하세요!**
- **작은 번호도 절대 놓치지 마세요!**

### 학습 예시 7: 컨테이너 번호 정확히 읽기 (매우 중요!) ⚠️
이미지 설명: Marks and Nos 섹션의 컨테이너 번호에 붉은색 마킹
  - 원본 텍스트(검은색): "CMAU9175970\nSEAL M1246515"
  - 붉은색 손글씨: "TXGUB856491\nSEAL M1246507"
분석 결과:
{
  "order": 7,
  "action": "수정",
  "original_text": "CMAU9175970\\nSEAL M1246515",
  "new_text": "TXGUB856491\\nSEAL M1246507",
  "location": "Marks and Nos",
  "confidence": "high"
}
⚠️ 주의사항:
- **컨테이너 번호의 모든 숫자를 정확히 읽으세요!**
- 9175970 ≠ 9157090 (5와 7의 순서 주의!)
- 숫자 하나하나를 신중하게 읽으세요!

### 학습 예시 8: 붉은색 박스 + 화살표 + 붉은색 타이핑된 텍스트 패턴 (매우 중요!) ⚠️⚠️
이미지 설명: NOTIFY PARTY 필드에 붉은색 박스와 화살표, 그리고 붉은색으로 타이핑된 새 텍스트
  - 원본 텍스트 (검은색, 박스 안):
    "CHISAGE RESOURCE GROUP CO., LTD
    10-11F, CHISAGE GROUP MANSION,
    NO.626 JINYUAN ROAD, PANHUO
    SUB-DISTRICT, YINZHOU DISTRICT,
    NINGBO CITY, ZHEJIANG PROVINCE"
  - 붉은색 박스로 원본 주소를 표시
  - 박스에서 화살표가 나와서 새로운 텍스트를 가리킴
  - 화살표 끝의 붉은색 타이핑된 텍스트 (여러 줄):
    "CHISAGE RESOURCE GROUP CO.,LTD
    CHISAGE BUILDING 10F, NO 626
    JINYUAN ROAD, PANHUO STREET
    YINZHOU, NINGBO, ZHEJIANG, CHINA
    TEL : 86-574-88291892  FAX : 86-574-88291935
    EMAIL : JOYSHAO AT CHISAGE.COM"
분석 결과:
{
  "order": 8,
  "action": "수정",
  "original_text": "CHISAGE RESOURCE GROUP CO., LTD\\n10-11F, CHISAGE GROUP MANSION,\\nNO.626 JINYUAN ROAD, PANHUO\\nSUB-DISTRICT, YINZHOU DISTRICT,\\nNINGBO CITY, ZHEJIANG PROVINCE",
  "new_text": "CHISAGE RESOURCE GROUP CO.,LTD\\nCHISAGE BUILDING 10F, NO 626\\nJINYUAN ROAD, PANHUO STREET\\nYINZHOU, NINGBO, ZHEJIANG, CHINA\\nTEL : 86-574-88291892  FAX : 86-574-88291935\\nEMAIL : JOYSHAO AT CHISAGE.COM",
  "location": "Notify Party",
  "confidence": "high"
}
⚠️ 주의사항:
- **붉은색으로 타이핑된 텍스트를 정확히 모두 읽으세요!**
- **원본 = 박스 안의 검은색 텍스트 (짧은 주소)**
- **변환문구 = 화살표가 가리키는 붉은색 텍스트 (긴 주소, 전화, 이메일 포함)**
- **붉은색 타이핑된 텍스트의 모든 줄을 읽고 \\n으로 구분하세요!**
- **손글씨가 아닌 타이핑된 텍스트도 붉은색이면 수정 지시사항입니다!**
"""

# 패턴 인식 가이드
PATTERN_GUIDE = """
## 수정/삭제 패턴 인식 가이드

### 1. 수정(Modification) 패턴의 특징:
✓ 화살표 존재: →, ➔, ⇒, -->, =>
✓ 원본 텍스트 + 화살표 + 새 텍스트 구조
✓ "변경", "수정", "change" 등의 단어
✓ 두 개의 텍스트가 연결됨
✓ 번호 표시: #1, #2, #20, #15 등 (수정 항목 번호)

### 2. 삭제(Deletion) 패턴의 특징 (매우 중요!) ⚠️:

#### 🚨 돼지꼬리 물결선 패턴 (가장 중요!) 🚨
**물결선(~~~, 돼지꼬리)은 다양한 형태로 나타납니다:**
✓ **넓은 루프 2개**: 가장 일반적인 형태
✓ **타이트한 루프**: 좁고 각진 물결선
✓ **두꺼운 루프**: 굵고 겹쳐진 루프
✓ **반투명 물결선**: 연한 분홍색, 투명 효과
✓ **얇고 섬세한 물결선**: 매우 얇은 선
✓ **끊어진 물결선**: 불완전한 루프 (그래도 삭제!)
✓ **대칭 물결선**: 완벽하게 대칭
✓ **부드러운 연결 물결선**: 루프 사이 부드러운 곡선
✓ **점선 스타일 물결선**: 점으로 이루어진 텍스처
✓ **날카로운 루프 물결선**: 빡빡하고 각진 루프
✓ **전문적 물결선**: 일정하고 세련된 모양

**색상 변형:**
- 밝은 붉은색 (bright red)
- 연한 분홍색 (light pink)
- 적갈색 (reddish-brown)
- 희미한 붉은색 (faded red)

**굵기 변형:**
- 매우 얇은 선 (very thin)
- 얇은 선 (thin)
- 중간 굵기 (medium)
- 두꺼운 선 (thick)

⚠️⚠️⚠️ **핵심**: 어떤 형태, 색상, 굵기든 물결선이면 = 100% 삭제!

#### 취소선 패턴:
✓ **직선 취소선: ---, ━━━, ───, strikethrough**
✓ **X 표시: ✕, ✗, ×, ㄨ**
✓ **"삭제", "delete", "remove" 등의 단어**
✓ **박스나 동그라미를 치고 그 위에 물결선이나 취소선**
✓ **박스/동그라미 + 취소선/물결선 = 삭제**
✗ **박스/동그라미만 있고 취소선/물결선 없으면 = 강조일 뿐, 삭제 아님!**

⚠️⚠️⚠️ **최우선 규칙: 취소선/물결선 = 무조건 삭제!** ⚠️⚠️⚠️
- **텍스트 위/가운데를 관통하는 선이 있으면 = 100% 삭제**
- **취소선이 보이면 화살표나 다른 표시는 무시하고 무조건 "삭제"**
- **물결선(~~~, 돼지꼬리)이 어떤 형태로든 보이면 무조건 "삭제"**
- **물결선이 완전하지 않아도, 희미해도, 점선이어도 = 삭제!**
- **action 필드는 반드시 "삭제"로 표기!**
- **new_text 필드는 반드시 "(DELETE)"로 표기!**

🚫🚫🚫 **절대 삭제가 아닌 경우 (강조 표시)** 🚫🚫🚫
- **박스만 있고 취소선/물결선/X표시가 전혀 없음 = 단순 강조일 뿐, 삭제 아님!**
- **예: "FREIGHT PREPAID"에 빨간 박스만 있고 선이 전혀 없음 = 그냥 강조**
- **박스 + 화살표 없음 + 취소선 없음 = 수정도 삭제도 아님, 무시하세요!**
- **이런 경우는 JSON 결과에 절대 포함하지 마세요!**

### 2-1. 약한 마킹 / 번호 표시 패턴 (중요!) ⚠️
**명확한 화살표나 취소선이 없어도, 다음 조건을 **모두** 만족하면 수정/삭제:**
✓ 박스, 밑줄, 동그라미로 표시된 텍스트
✓ **AND** 번호 표시(#1, #2, #3 등) **또는** 손글씨 추가
✓ **AND** 붉은색/분홍색 마킹

⚠️ **주의**: 박스만 있고 화살표/취소선/번호/손글씨가 전혀 없으면 = 단순 강조, 무시!
→ 예: "FREIGHT PREPAID"에 박스만 = 강조일 뿐, 수정/삭제 아님!

### 2-2. 붉은색 박스 + 화살표 + 붉은색 타이핑된 텍스트 패턴 (매우 중요!) ⚠️⚠️
**손글씨가 아니어도 수정 지시사항:**
✓ **붉은색 박스로 원본 텍스트를 표시 (검은색 인쇄된 텍스트)**
✓ 박스에서 화살표가 나와서 다른 텍스트를 가리킴
✓ **화살표가 가리키는 곳에 붉은색으로 타이핑된 새 텍스트**
✓ 붉은색 타이핑된 텍스트 = 최종 변환문구
✓ 여러 줄의 주소, 전화번호, 이메일 등이 포함될 수 있음
→ **박스 안 = 원본 텍스트, 화살표 끝의 붉은색 텍스트 = 변환문구!**
→ **붉은색 타이핑된 텍스트의 모든 줄을 읽고 \\n으로 구분하세요!**

### 3. 여러 줄 텍스트 처리 (매우 중요!) ⚠️⚠️⚠️
**하나의 박스 안에 여러 줄이 있는 경우:**
- ✓ **모든 줄을 읽고 반드시 하나의 JSON 항목으로 처리**
- ✓ **각 줄은 \\n (줄바꿈)으로 구분**
- ✓ **예: "TEL:0574-87170623\\nFAX:0574-87026831"**
- ✓ **첫 줄만 읽지 말고 박스 안의 모든 텍스트 읽기!**
- ✓ **절대 각 줄을 개별 항목으로 분리하지 마세요!**

⚠️⚠️⚠️ **핵심 규칙: 같은 박스 = 하나의 JSON 항목!**
**예시: NOTIFY PARTY 연락처 정보**
```
잘못된 예 (❌):
[
  {"original_text": "USCI:...", ...},
  {"original_text": "CONTACT PERSON...", ...},
  {"original_text": "TEL:...", ...},
  {"original_text": "EMAIL:...", ...}
]

올바른 예 (✅):
[
  {"original_text": "USCI:...\\nCONTACT PERSON...\\nTEL:...\\nEMAIL:...", ...}
]
```

**병렬로 표시된 수정사항:**
- ✓ 원본도 여러 줄이면 모두 읽기
- ✓ 새 텍스트도 여러 줄이면 모두 읽기
- ✓ 원본: "LDPE FT4119\\nQUANTITY. 24.75MT"
- ✓ 새 텍스트: "COMMODITY : LDPE FT4119\\nQUANTITY : 24.75MT"

### 4. 손글씨 읽기 팁 (매우 중요!) ⚠️:
- **쉼표(,)를 절대 빠뜨리지 마세요!** - "KHALIFA PORT, U.A.E"
- **마침표(.)를 절대 빠뜨리지 마세요!** - "U.A.E" (점 3개)
- 대문자와 소문자 구분 주의
- 콜론(:)과 세미콜론(;) 구분
- 숫자 0과 알파벳 O 구분
- 숫자 1과 알파벳 I/l 구분
- **AUH ≠ A.U.H ≠ U.A.E** (완전히 다른 텍스트!)

### 5. 위치(Location) 파악:
- 텍스트가 있는 문서의 섹션/필드명 정확히 파악
- 일반적인 Bill of Lading 필드:
  * Shipper (화주)
  * Consignee (수하인)
  * Notify Party (통지처)
  * Place of Receipt (수령지)
  * Port of Loading (선적항)
  * Port of Discharge (양하항)
  * Final Destination (최종 목적지)
  * Description of Goods (화물 명세)
  * Container Number (컨테이너 번호)
  * Gross Weight (총 중량)
"""

# 정확도 향상을 위한 체크리스트
ACCURACY_CHECKLIST = """
## 분석 정확도 체크리스트

### 반드시 확인해야 할 사항 (우선순위 순서):
1. ✓ **🚨 취소선/물결선 확인 (최우선!)**: 취소선이나 물결선이 있나요? → **무조건 100% 삭제!** ⚠️⚠️⚠️
   - 텍스트를 관통하는 선이 보이면 다른 것은 보지 말고 바로 "삭제"
   - action = "삭제", new_text = "(DELETE)"
2. ✓ **번호 표시(#1, #2, #20, #15)가 있나요? → 그 주변 반드시 확인!** ⚠️
3. ✓ **화살표가 있나요?** → 취소선 없으면 수정
4. ✓ **모든 물결선/취소선을 찾았나요? 여러 개 있을 수 있습니다!** ⚠️
5. ✓ **약한 마킹(박스, 밑줄, 동그라미)도 확인했나요?** ⚠️
6. ✓ **붉은색 박스 안에 타이핑된 텍스트가 있나요? → 화살표 확인!** ⚠️⚠️
7. ✓ **박스 안에 여러 줄이 있나요? → 모든 줄을 읽고 \\n으로 구분!** ⚠️
8. ✓ **손글씨의 쉼표(,)와 마침표(.)를 읽었나요?** ⚠️
9. ✓ **U.A.E는 점 3개입니다: U.A.E** ⚠️
10. ✓ 대소문자를 구분했나요?
11. ✓ 숫자와 알파벳을 구분했나요?
12. ✓ 원본 텍스트 위치(필드명)를 확인했나요?
13. ✓ 모든 붉은색 마킹을 빠짐없이 찾았나요?
14. ✓ **NOTIFY PARTY 필드를 확인했나요?** ⚠️

### 흔한 실수 방지:
❌ 화살표가 있는데 삭제로 분류
❌ 손글씨의 일부만 읽음
❌ **여러 줄 중 첫 줄만 읽음 (가장 흔한 실수!)** ⚠️
❌ **줄바꿈을 무시하고 한 줄로 합침** ⚠️
❌ **NOTIFY PARTY 섹션 하단의 연락처 정보(USCI, CONTACT PERSON, TEL, EMAIL)를 놓침 (매우 흔한 실수!)** ⚠️⚠️⚠️
❌ **작고 눈에 잘 띄지 않는 삭제 항목을 누락** ⚠️⚠️
❌ **여러 개의 작은 박스들을 하나로 합치거나 일부만 인식** ⚠️⚠️
❌ U.A.E를 U.A.EMIRATES로 잘못 읽음
❌ 쉼표(,)를 빠뜨림
❌ 콜론(:)을 빠뜨림
❌ 위치를 잘못 파악

### 여러 줄 텍스트 처리 예시:
✅ 올바른 예: "TEL:0574-87170623\\nFAX:0574-87026831"
❌ 잘못된 예: "TEL:0574-87170623" (두 번째 줄 누락)
❌ 잘못된 예: "TEL:0574-87170623 FAX:0574-87026831" (줄바꿈 무시)
"""


def get_enhanced_prompt(full_page_text=""):
    """Few-Shot Learning이 적용된 향상된 프롬프트 생성"""
    
    prompt = f"""당신은 Bill of Lading 문서의 수정/삭제 지시사항을 분석하는 전문가입니다.
이미지에 표시된 붉은색 계열의 모든 수정사항을 정확하게 인식해야 합니다.

{SAMPLE_EXAMPLES}

{PATTERN_GUIDE}

{ACCURACY_CHECKLIST}

## 현재 분석 대상 문서:
이 Bill of Lading 문서를 위의 학습 예시를 참고하여 분석하세요.

### 🔍 특별 주의사항 - 반드시 확인할 필드:
⚠️ **Port of Loading (선적항)** 필드를 주의깊게 확인하세요!
- 이 필드 주변에 #20, #15, #1, #2 같은 번호 표시가 있는지 찾기
- 번호 표시가 있으면 그 주변의 모든 손글씨를 읽기
- Port of Loading 필드의 원래 텍스트가 무엇인지 확인
- 번호와 함께 표시된 새로운 텍스트가 무엇인지 확인

### 분석 절차:
1. ⚠️⚠️ **첫 번째 스캔 - 모든 번호 찾기**:
   - 이미지 전체를 천천히 스캔
   - #1부터 #99까지 모든 번호 표시를 찾기
   - 찾은 번호 목록 작성: #20, #35, #36, #37 등
   - **번호를 하나라도 놓치면 안됩니다!** ⚠️⚠️
2. ⚠️⚠️ **두 번째 스캔 - 각 번호 주변 분석**:
   - 각 번호 주변 20cm 반경 내의 모든 텍스트 읽기
   - 번호가 가리키는 원본 텍스트 찾기
   - 번호 주변의 새 텍스트(손글씨 또는 타이핑) 찾기
   - **여러 개의 번호가 같은 영역에 있어도 각각 별도로 처리!** ⚠️
3. ⚠️ **Port of Loading 필드 집중 분석**:
   - Port of Loading, PORT OF LOADING, 선적항 등의 표현 찾기
   - 이 필드에 박스, 동그라미, 밑줄, 번호 표시가 있는지 확인
   - 이 필드와 연결된 손글씨가 있는지 확인
4. ⚠️⚠️⚠️ **각 마킹 위에 취소선(---, strikethrough) 또는 물결선(~~~)이 있는지 확인 (최우선!)**:
   - **취소선이 텍스트를 관통하면 = 무조건 100% "삭제"**
   - **물결선이 텍스트 위에 있으면 = 무조건 100% "삭제"**
   - **화살표가 있어도 취소선/물결선이 있으면 = "삭제" 우선!**
   - 여러 개의 물결선/취소선이 있을 수 있으니 모두 찾기
   - **action = "삭제", new_text = "(DELETE)"로 표기!**
   - **"FREIGHT PREPAID" 텍스트를 특히 주의깊게 찾기! (자주 누락됨!)** ⚠️⚠️⚠️
   - **"14 DAYS CONTAINER FREE DETENTION AND DEMURRAGE AT POD" 텍스트 찾기!** ⚠️⚠️
   - 취소선/물결선 없고 화살표만 있으면 = 수정
5. ⚠️⚠️ **붉은색 박스 + 화살표 + 붉은색 타이핑된 텍스트 패턴 확인**:
   - 붉은색 박스로 표시된 검은색 텍스트 찾기 (원본)
   - 박스에서 나오는 화살표 확인
   - 화살표 끝의 붉은색으로 타이핑된 텍스트 찾기
   - **붉은색 타이핑된 텍스트의 모든 줄을 읽기 (TEL, FAX, EMAIL 포함)**
   - 이 붉은색 타이핑된 텍스트 = 최종 변환문구
6. ⚠️ **약한 마킹도 모두 확인**: 박스, 밑줄, 동그라미, 번호만 있어도 수정사항!
7. ⚠️ **박스 안에 여러 줄이 있는지 확인** - 있으면 모든 줄을 읽기!
8. 🔍 **원본 텍스트(검은색 인쇄)를 천천히, 정확하게 읽기**:
   - 모든 단어를 포함
   - 모든 쉼표, 마침표 포함
   - 컨테이너 번호의 모든 숫자 정확히 읽기
   - 예: "KHALIFA PORT, ABU DHABI, UAE" (전체 읽기)
   - 예: "CMAU9175970" (모든 숫자 정확히)
9. 화살표가 가리키는 손글씨 OR 타이핑된 텍스트를 정확히 읽기 (여러 줄이면 \\n으로 구분)
10. 번호와 연결된 손글씨 텍스트 찾기
11. 해당 텍스트가 위치한 문서 필드명 파악
12. 신뢰도 평가 (high/medium/low)

### JSON 출력 형식:
```json
[
  {{
    "order": 1,
    "action": "수정" or "삭제",
    "original_text": "박스로 표시된 원본 텍스트 (여러 줄이면 \\n으로 구분)",
    "new_text": "화살표가 가리키는 새 텍스트 (여러 줄이면 \\n으로 구분) 또는 (DELETE)",
    "location": "문서 필드명 (정확히)",
    "confidence": "high/medium/low"
  }},
  {{
    "order": 35,
    ...
  }},
  {{
    "order": 36,
    ...
  }},
  {{
    "order": 37,
    ...
  }}
]
```

⚠️ 중요: 
- **번호가 #35, #36, #37이면 3개의 별도 항목을 만드세요!**
- **order 번호는 이미지의 번호(#35)를 그대로 사용하세요!**
- **번호 하나당 JSON 객체 하나!**
- **⚠️⚠️⚠️ NOTIFY PARTY 섹션 하단의 연락처 정보를 반드시 확인하세요! (매우 자주 누락!)** ⚠️⚠️⚠️
  - USCI: ... (박스 + 돼지꼬리)
  - CONTACT PERSON NAME: ... (박스 + 돼지꼬리)
  - CONTACT PERSON TEL: ... (박스 + 돼지꼬리)
  - EMAIL: ... (박스 + 돼지꼬리)
  - **4개가 모두 별도 항목입니다!**
- **⚠️⚠️ "14 DAYS CONTAINER FREE..." 텍스트에 취소선이 있는지 확인하세요!** ⚠️⚠️

### 여러 줄 텍스트 예시:
- 한 줄: "ABU DHABI, U.A.E"
- 두 줄: "TEL:0574-87170623\\nFAX:0574-87026831"
- 세 줄: "첫줄\\n둘째줄\\n셋째줄"

{f"### 문서 전체 텍스트 (참고):\\n{full_page_text[:1500]}" if full_page_text else ""}

⚠️ 🚨 매우 매우 중요 - 반드시 지켜야 할 사항 🚨 ⚠️

### 🚨🚨🚨 1순위: 취소선/물결선 확인이 최우선! 🚨🚨🚨
**취소선이나 물결선이 있으면 다른 것은 보지 말고 무조건 "삭제"!**

#### 🚨🚨🚨 특별 주의: NOTIFY PARTY 연락처 정보! (매우 자주 누락!) 🚨🚨🚨
- **NOTIFY PARTY 섹션 하단의 연락처 정보는 매우 자주 누락됩니다!**
- **이미지 중간~하단 영역을 반드시 천천히 스캔하세요!**
- **다음 4개 항목을 각각 확인하세요:**
  1. **USCI: 91330212MA28840CY4D** (또는 유사한 번호)
  2. **CONTACT PERSON NAME: MS. JOY SHAO** (또는 다른 이름)
  3. **CONTACT PERSON TEL: 86-574-88291892** (또는 다른 전화번호)
  4. **EMAIL: JOYSHAO@CHISAGE.COM** (또는 다른 이메일)
- **각 줄마다 별도의 박스 + 돼지꼬리가 있으면 각각 독립된 삭제 항목!**
- **4개가 연속으로 표시되어도 각각 별도 JSON 객체 생성!**
- **작은 박스들을 절대 놓치지 마세요!**
- **이 항목들을 놓치면 분석이 매우 불완전합니다!** ⚠️⚠️⚠️

#### 취소선/물결선 판단 규칙:
1. ✅ **취소선(---, ━━━, ───, strikethrough)이 텍스트 위/가운데를 관통하나요?**
   - → **무조건 action = "삭제"**
   - → **무조건 new_text = "(DELETE)"**
   - → **화살표나 다른 표시가 있어도 무시!**

2. ✅ **물결선(~~~, 돼지꼬리)이 텍스트 위에 있나요?**
   **물결선은 다양한 형태로 나타납니다 - 모두 삭제!**
   
   형태별 변형:
   - 넓은 루프 2개 (가장 일반적)
   - 타이트한 루프 (좁고 각진)
   - 두꺼운 루프 (굵고 겹침)
   - 반투명 물결선 (연한 분홍)
   - 얇고 섬세한 물결선
   - 끊어진 물결선 (불완전해도 삭제!)
   - 대칭/비대칭 물결선
   - 점선 스타일 물결선
   - 날카로운/부드러운 루프
   
   색상 변형:
   - 밝은 붉은색
   - 연한 분홍색
   - 적갈색
   - 희미한 붉은색
   
   굵기 변형:
   - 매우 얇은 선 ~ 두꺼운 선
   
   ⚠️⚠️⚠️ **핵심**:
   - → **어떤 형태, 색상, 굵기든 물결선이면 무조건 action = "삭제"**
   - → **무조건 new_text = "(DELETE)"**
   - → **화살표나 다른 표시가 있어도 무시!**
   - → **완전하지 않아도, 희미해도, 점선이어도 = 삭제!**

3. ❌ **취소선도 물결선도 없나요?**
   - → 그때 비로소 화살표나 번호 표시를 확인
   - → 화살표 있으면 "수정"
   - → 번호 표시만 있어도 "수정"

⚠️ **핵심**: 취소선/물결선 = 100% 삭제! 예외 없음!

---

### 🚨🚨🚨 2순위: 번호 찾기가 두 번째 우선! 🚨🚨🚨
**번호를 하나라도 놓치면 전체 분석이 실패입니다!**

### 번호 찾기 프로세스 (반드시 따르세요):
1. 🔍 **첫 번째 단계: 이미지를 10번 이상 매우 천천히 스캔**
   - 위에서 아래로 천천히
   - 왼쪽에서 오른쪽으로 천천히
   - 모든 붉은색 마킹 확인
2. 🔍 **두 번째 단계: 모든 번호 표시 찾기**
   - #1, #2, #3... #99까지 모든 번호
   - 작게 쓰여진 번호도 찾기
   - 여러 개가 밀집된 번호도 모두 찾기
   - 예: #35, #36, #37이 가까이 있으면 3개 모두 찾기
3. 🔍 **세 번째 단계: 각 번호마다 별도 분석**
   - 번호 1개 = 수정 항목 1개
   - #35, #36, #37 = 3개의 별도 항목
   - 각 번호 주변 20cm 이내의 텍스트 읽기

### 번호 표시 처리 규칙 (가장 중요!) 🚨🚨:
- ✅ **#1부터 #99까지 모든 번호를 찾으세요!** (#1, #2, #15, #20, #35, #36, #37, #50 등)
- ✅ **번호가 있으면 그 주변에 반드시 수정/삭제 지시사항이 있습니다!**
- ✅ **번호 주변 20cm 이내의 모든 손글씨/타이핑된 텍스트를 읽으세요!**
- ✅ **여러 개의 번호(#35, #36, #37)가 가까이 있어도 각각 별도의 항목!**
- ✅ **번호가 어떤 원본 텍스트를 가리키는지 확인하세요!**
- ✅ **작은 번호도 절대 놓치지 마세요!** (#35처럼 작게 쓰여진 번호도 100% 인식)

### 마킹 인식 규칙 (우선순위 순서로):

#### 🚨🚨🚨 1순위: 취소선/물결선 확인 (가장 중요!) 🚨🚨🚨
- **취소선(---, ━━━, ───, strikethrough)이 텍스트 위에 있나요?**
  - ✅ 있으면 → **무조건 "삭제"!**
  - ✅ action = "삭제"
  - ✅ new_text = "(DELETE)"
  - ⚠️ **화살표나 다른 표시가 있어도 무시하고 "삭제"로 분류!**
- **물결선(~~~, 돼지꼬리)이 텍스트 위에 있나요?**
  - ✅ 있으면 → **무조건 "삭제"!**
  - ⚠️ **물결선이 보이면 100% 삭제입니다!**
- **여러 개의 물결선/취소선이 있으면 각각 별도의 삭제 항목!** ⚠️
- **🚨🚨🚨 NOTIFY PARTY 하단 연락처 정보를 반드시 찾으세요! (매우 자주 누락!)** ⚠️⚠️⚠️
  - USCI, CONTACT PERSON NAME, CONTACT PERSON TEL, EMAIL
  - 이미지 중간~하단을 천천히 전체 스캔
  - 작은 박스들도 모두 확인
  - 각 줄마다 박스 + 물결선이 있으면 각각 삭제 항목 추가
  - **4개 항목 모두 찾아야 합니다!**

#### 2순위: 화살표 확인 (취소선이 없을 때만)
- 화살표(→)가 보이고 취소선이 없으면 → "수정"

#### 3순위: 기타 마킹
- **박스, 밑줄, 동그라미, 번호 표시 = 수정 지시사항 (취소선 없을 때)**
- **붉은색 박스 + 화살표 + 붉은색 타이핑된 텍스트 패턴 인식!** ⚠️⚠️
  - 박스 안 = 원본 텍스트 (검은색)
  - 화살표 끝 = 변환문구 (붉은색 타이핑)
  - **화살표가 가리키는 붉은색 타이핑된 텍스트의 모든 줄을 읽으세요!**
- **하나의 박스에 여러 줄이 있으면 모든 줄을 읽고 \\n으로 구분!**
- **TEL + FAX + EMAIL처럼 여러 줄이 함께 있으면 하나의 항목으로!**
- **첫 줄만 읽지 말고 모든 텍스트를 읽으세요!**

⚠️⚠️ **핵심 원칙**: 취소선/물결선이 보이면 다른 것은 보지 말고 바로 "삭제"!

### 텍스트 읽기 규칙:
- 🔍 **원본 텍스트(검은색 인쇄된 텍스트)를 정확히 읽기** - 한 글자도 빠뜨리거나 바꾸지 마세요!
- 🔍 **붉은색 타이핑된 텍스트를 모두 읽기** - TEL, FAX, EMAIL 등 모든 줄 포함! ⚠️⚠️
- 🔍 **숫자 정확히 읽기**: 5와 9, 7과 1, 0과 O를 구분하세요
- 🔍 **컨테이너 번호 전체 읽기**: CMAU9175970처럼 모든 숫자를 정확히
- 🔍 **손글씨의 쉼표(,)와 마침표(.)를 절대 빠뜨리지 마세요!** ⚠️⚠️
  - "KHALIFA PORT, U.A.E" (쉼표 1개, 점 3개)
  - ❌ "KHALIFA PORT AUH" (쉼표와 점 없음 - 잘못됨!)
- 손글씨를 한 글자도 빠뜨리지 말고 정확히 읽기
- 대소문자, 문장부호 정확히 인식
- 모든 붉은색 마킹을 빠짐없이 분석
- **이미지에서 직접 번호를 찾고 그 주변 손글씨를 읽으세요!**
- **붉은색 타이핑된 텍스트는 6-7줄 정도의 긴 주소일 수 있습니다 - 모두 읽으세요!**

### Port of Loading 필드 특별 규칙:
- 🔴 **Port of Loading 필드에 번호나 마킹이 있으면 절대 무시하지 마세요!**
- 🔴 **#20이나 #15가 Port of Loading 근처에 있으면 반드시 분석하세요!**
- 🔴 **Port of Loading의 원본 텍스트를 완전하게 읽으세요!**
  - 예: "KHALIFA PORT, ABU DHABI, UAE" (전체를 읽기)
  - ❌ "KHALIFA PORT, UAE" (중간 부분 생략하지 마세요!)

### Notify Party 필드 특별 규칙 (매우 중요! 자주 누락!) ⚠️⚠️⚠️:
- 🔴 **Notify Party 필드를 반드시 확인하세요!**
- 🔴 **주소 수정사항뿐만 아니라 하단의 연락처 정보 삭제 항목도 확인!**
- 🔴 **붉은색 박스와 화살표가 있는지 확인!**
- 🔴 **박스 안의 검은색 텍스트 = 원본 텍스트 (대상문구)**
- 🔴 **화살표가 가리키는 붉은색 타이핑된 텍스트 = 변환문구**
- 🔴 **붉은색 타이핑된 텍스트의 모든 줄을 정확히 읽으세요!**
- 🔴🔴🔴 **Notify Party 섹션 하단의 4개 연락처 정보를 절대 놓치지 마세요:**
  1. **USCI: 91330212MA28840CY4D** (또는 유사 번호) - 박스 + 돼지꼬리
  2. **CONTACT PERSON NAME: MS. JOY SHAO** (또는 다른 이름) - 박스 + 돼지꼬리
  3. **CONTACT PERSON TEL: 86-574-88291892** (또는 다른 번호) - 박스 + 돼지꼬리
  4. **EMAIL: JOYSHAO@CHISAGE.COM** (또는 다른 이메일) - 박스 + 돼지꼬리
- 🔴 **각 줄마다 별도의 박스가 있으면 각각 독립된 삭제 항목으로 인식!**
  - 예시 원본 (박스 안, 검은색):
    "CHISAGE RESOURCE GROUP CO., LTD
    10-11F, CHISAGE GROUP MANSION,
    NO.626 JINYUAN ROAD, PANHUO
    SUB-DISTRICT, YINZHOU DISTRICT,
    NINGBO CITY, ZHEJIANG PROVINCE"
  - 예시 변환문구 (화살표 끝, 붉은색):
    "CHISAGE RESOURCE GROUP CO.,LTD
    CHISAGE BUILDING 10F, NO 626
    JINYUAN ROAD, PANHUO STREET
    YINZHOU, NINGBO, ZHEJIANG, CHINA
    TEL : 86-574-88291892  FAX : 86-574-88291935
    EMAIL : JOYSHAO AT CHISAGE.COM"
- 🔴 **TEL, FAX, EMAIL 정보도 모두 포함하여 읽으세요!**

### 원본 텍스트(검은색 인쇄) 읽기 규칙:
- 🔍 **검은색으로 인쇄된 원본 텍스트를 100% 정확하게 읽으세요**
- 🔍 **한 글자, 한 단어도 빠뜨리지 마세요**
- 🔍 **쉼표, 마침표도 그대로 포함하세요**
- 🔍 **컨테이너 번호는 모든 숫자를 정확히 읽으세요**
  - 예: CMAU9175970 (9175970을 정확히)
  - ❌ CMAU9157090 (숫자를 바꾸지 마세요!)
- 🔍 **5와 9, 7과 1, 0과 O를 정확히 구분하세요**

JSON 배열만 반환하세요."""
    
    return prompt
